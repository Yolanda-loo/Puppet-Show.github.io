<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina Player</title>
    <style>
        :root {
            --primary-color: #6366f1; /* Indigo-500 for a modern look */
            --bg-color: #0f172a;      /* Slate-900 */
            --control-bg: linear-gradient(to top, rgba(15, 23, 42, 0.95), transparent);
            --text-color: #f8fafc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: #020617; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; 
            color: white;
        }

        /* Container */
        .lumina-player {
            position: relative;
            width: 90%;
            max-width: 900px;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            group: focus;
        }
        
        .lumina-player.fullscreen { max-width: 100%; width: 100%; height: 100vh; border-radius: 0; aspect-ratio: auto; }
        
        video { width: 100%; height: 100%; display: block; cursor: pointer; }
        
        /* Caption Styling */
        video::cue {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-family: sans-serif;
            border-radius: 4px;
        }

        /* Overlays */
        .overlay-icon {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            padding: 24px;
            display: flex;
            align-items: center; justify-content: center;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 60px; height: 60px;
            animation: spin 1s linear infinite;
            display: none;
            padding: 0; /* Override padding for spinner */
        }
        @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Control Bar */
        .controls {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: var(--control-bg);
            padding: 20px 20px 15px 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            opacity: 1;
            transition: opacity 0.3s ease;
        }
        .lumina-player.user-inactive .controls { opacity: 0; pointer-events: none; }
        .lumina-player.paused .controls { opacity: 1 !important; pointer-events: auto; }

        /* Progress Bar */
        .progress-container { width: 100%; margin-bottom: 12px; display: flex; align-items: center; height: 10px; cursor: pointer; }
        .progress {
            width: 100%; height: 4px;
            background: rgba(255,255,255,0.2);
            position: relative;
            border-radius: 2px;
            transition: height 0.1s;
        }
        .progress-container:hover .progress { height: 6px; }
        
        .progress-filled {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            border-radius: 2px;
            position: relative;
        }
        /* Scrubber Head */
        .progress-filled::after {
            content: '';
            position: absolute; right: -6px; top: 50%; transform: translateY(-50%);
            width: 12px; height: 12px; border-radius: 50%; background: #fff;
            opacity: 0; transition: opacity 0.1s;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .progress-container:hover .progress-filled::after { opacity: 1; }

        .seek-slider {
            position: absolute; width: 100%; height: 100%; top: -5px; left: 0;
            opacity: 0; cursor: pointer; margin: 0; padding: 5px 0; /* Increase hit area */
        }

        /* Buttons & Inputs */
        .btn-group { display: flex; align-items: center; gap: 18px; flex: 1; }
        .right-controls { display: flex; align-items: center; gap: 18px; margin-left: auto; }
        
        button {
            background: none; border: none; cursor: pointer; color: #cbd5e1;
            padding: 0; transition: all 0.2s; display: flex; align-items: center;
        }
        button:hover { color: #fff; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
        button.active { color: var(--primary-color); }
        button svg { width: 22px; height: 22px; fill: currentColor; }

        .time { font-size: 13px; font-weight: 500; color: #e2e8f0; font-variant-numeric: tabular-nums; font-family: monospace; }
        
        /* Volume */
        .volume-container { display: flex; align-items: center; gap: 8px; group-hover: width 100px; }
        input[type="range"].vol-slider {
            width: 0; height: 4px; -webkit-appearance: none; background: rgba(255,255,255,0.3); border-radius: 2px;
            transition: width 0.2s ease; overflow: hidden;
        }
        .volume-container:hover input[type="range"].vol-slider,
        input[type="range"].vol-slider:focus { width: 70px; }
        
        input[type="range"].vol-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 10px; height: 10px; border-radius: 50%; background: #fff; cursor: pointer;
        }

        /* Speed Selector */
        select.speed-select {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); 
            color: #fff; font-size: 12px; padding: 4px 8px; border-radius: 4px; cursor: pointer; outline: none;
        }
        select.speed-select:hover { background: rgba(255,255,255,0.2); }
        select.speed-select option { background: #0f172a; color: white; }

        /* Error Message */
        .error-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(220, 38, 38, 0.9); color: white; padding: 16px 24px; 
            border-radius: 8px; font-weight: 600; text-align: center; display: none;
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>

<div class="lumina-player" id="videoContainer" tabindex="0">
    <video id="video" playsinline crossorigin="anonymous">
        <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/TearsOfSteel.mp4" type="video/mp4">
        <track label="English" kind="captions" src="subtitles-en.vtt" srclang="en">
    </video>
    
    <div class="overlay-icon spinner" id="spinner"></div>
    <div class="overlay-icon" id="centerPlay">
        <svg viewBox="0 0 24 24" width="48" height="48" fill="white"><path d="M8 5v14l11-7z"/></svg>
    </div>
    <div class="error-msg" id="errorMsg">
        ⚠️ Playback Error<br>
        <span style="font-size: 0.8em; font-weight: 400;">The video source could not be loaded.</span>
    </div>

    <div class="controls">
        <div class="progress-container">
            <div class="progress">
                <div class="progress-filled" id="progressBar"></div>
                <input type="range" min="0" max="100" step="0.1" value="0" class="seek-slider" id="seek" aria-label="Seek video">
            </div>
        </div>

        <div class="btn-group">
            <button id="playBtn" aria-label="Play">
                <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg class="pause-icon" viewBox="0 0 24 24" style="display:none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>

            <div class="volume-container">
                <button id="muteBtn" aria-label="Mute">
                    <svg class="vol-high" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                    <svg class="vol-mute" viewBox="0 0 24 24" style="display:none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                </button>
                <input type="range" class="vol-slider" id="volume" min="0" max="1" step="0.05" value="1" aria-label="Volume">
            </div>

            <div class="time">
                <span id="currentTime">00:00</span> / <span id="duration">00:00</span>
            </div>
        </div>

        <div class="right-controls">
            <select id="speed" class="speed-select" aria-label="Playback Speed">
                <option value="0.5">0.5x</option>
                <option value="1" selected>1x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
            </select>
            
            <button id="ccBtn" aria-label="Toggle Captions" title="Captions (C)">
                <svg viewBox="0 0 24 24"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/></svg>
            </button>

            <button id="pipBtn" aria-label="Picture in Picture" title="Mini Player (P)">
                <svg viewBox="0 0 24 24"><path d="M19 11h-8v6h8v-6zm4 8V4.98C23 3.88 22.1 3 21 3H3c-1.1 0-2 .88-2 1.98V19c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2zm-2 .02H3V4.97h18v14.05z"/></svg>
            </button>

            <button id="fsBtn" aria-label="Fullscreen" title="Fullscreen (F)">
                <svg class="fs-enter" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                <svg class="fs-exit" viewBox="0 0 24 24" style="display:none;"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    const container = document.getElementById('videoContainer');
    const video = document.getElementById('video');
    const playBtn = document.getElementById('playBtn');
    const playIcon = container.querySelector('.play-icon');
    const pauseIcon = container.querySelector('.pause-icon');
    const centerPlay = document.getElementById('centerPlay');
    const spinner = document.getElementById('spinner');
    const errorMsg = document.getElementById('errorMsg');
    const progressFilled = document.getElementById('progressBar');
    const seekSlider = document.getElementById('seek');
    const timeDisplay = document.getElementById('currentTime');
    const durationDisplay = document.getElementById('duration');
    const volumeSlider = document.getElementById('volume');
    const muteBtn = document.getElementById('muteBtn');
    const volHighIcon = muteBtn.querySelector('.vol-high');
    const volMuteIcon = muteBtn.querySelector('.vol-mute');
    const speedSelect = document.getElementById('speed');
    const fsBtn = document.getElementById('fsBtn');
    const ccBtn = document.getElementById('ccBtn');
    const pipBtn = document.getElementById('pipBtn');

    let hideTimeout;

    // --- Core Logic ---

    function togglePlay() {
        if (video.paused || video.ended) video.play();
        else video.pause();
    }

    function updatePlayState() {
        if (video.paused) {
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
            centerPlay.style.opacity = '1';
            centerPlay.style.transform = 'translate(-50%, -50%) scale(1)';
            container.classList.add('paused');
        } else {
            playIcon.style.display = 'none';
            pauseIcon.style.display = 'block';
            centerPlay.style.opacity = '0';
            centerPlay.style.transform = 'translate(-50%, -50%) scale(1.5)';
            container.classList.remove('paused');
        }
    }

    function handleProgress() {
        if (!video.duration) return;
        const percent = (video.currentTime / video.duration) * 100;
        progressFilled.style.width = `${percent}%`;
        seekSlider.value = percent;
        timeDisplay.textContent = formatTime(video.currentTime);
    }

    function updateVolumeIcon() {
        if (video.muted || video.volume === 0) {
            volHighIcon.style.display = 'none';
            volMuteIcon.style.display = 'block';
        } else {
            volHighIcon.style.display = 'block';
            volMuteIcon.style.display = 'none';
        }
    }

    function togglePip() {
        if (document.pictureInPictureElement) {
            document.exitPictureInPicture();
        } else if (document.pictureInPictureEnabled) {
            video.requestPictureInPicture();
        }
    }

    function toggleCaptions() {
        // Find the first caption track
        const track = video.textTracks[0];
        if (!track) return alert("No subtitles available.");
        
        if (track.mode === 'showing') {
            track.mode = 'hidden';
            ccBtn.classList.remove('active');
        } else {
            track.mode = 'showing';
            ccBtn.classList.add('active');
        }
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function handleActivity() {
        container.classList.remove('user-inactive');
        clearTimeout(hideTimeout);
        if (!video.paused) {
            hideTimeout = setTimeout(() => container.classList.add('user-inactive'), 2500);
        }
    }

    // --- Listeners ---
    
    // Playback
    video.addEventListener('click', togglePlay);
    playBtn.addEventListener('click', togglePlay);
    video.addEventListener('play', updatePlayState);
    video.addEventListener('pause', updatePlayState);
    centerPlay.addEventListener('click', togglePlay);

    // Time
    video.addEventListener('timeupdate', handleProgress);
    seekSlider.addEventListener('input', (e) => {
        const time = (e.target.value / 100) * video.duration;
        video.currentTime = time;
    });
    video.addEventListener('loadedmetadata', () => {
        durationDisplay.textContent = formatTime(video.duration);
        
        // Hide CC button if no tracks found
        if (video.textTracks.length === 0) ccBtn.style.display = 'none';
    });

    // Volume
    volumeSlider.addEventListener('input', (e) => {
        video.volume = e.target.value;
        video.muted = false;
        updateVolumeIcon();
    });
    muteBtn.addEventListener('click', () => {
        video.muted = !video.muted;
        if(video.muted) volumeSlider.value = 0;
        else volumeSlider.value = video.volume || 1;
        updateVolumeIcon();
    });

    // Speed
    speedSelect.addEventListener('change', (e) => video.playbackRate = e.target.value);

    // Extensions (PiP & CC)
    if (pipBtn) pipBtn.addEventListener('click', togglePip);
    if (ccBtn) ccBtn.addEventListener('click', toggleCaptions);

    // Fullscreen
    fsBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
            container.requestFullscreen();
            container.classList.add('fullscreen');
        } else {
            document.exitFullscreen();
            container.classList.remove('fullscreen');
        }
    });

    // UI States
    video.addEventListener('waiting', () => spinner.style.display = 'block');
    video.addEventListener('canplay', () => spinner.style.display = 'none');
    video.addEventListener('error', () => {
        spinner.style.display = 'none';
        errorMsg.style.display = 'block';
    });
    container.addEventListener('mousemove', handleActivity);
    
    // Shortcuts
    document.addEventListener('keydown', (e) => {
        if (['INPUT', 'SELECT'].includes(document.activeElement.tagName)) return;
        
        switch(e.key.toLowerCase()) {
            case ' ':
            case 'k': e.preventDefault(); togglePlay(); break;
            case 'f': container.requestFullscreen(); break;
            case 'p': togglePip(); break;
            case 'c': toggleCaptions(); break;
            case 'm': muteBtn.click(); break;
            case 'arrowright': video.currentTime += 5; break;
            case 'arrowleft': video.currentTime -= 5; break;
        }
        handleActivity();
    });
</script>
</body>
</html>
